<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Product â€” VulnShop</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../assets/css/style.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">VulnShop</div>
    <nav>
      <a href="../index.html">Home</a>
      <a href="../search.html">Search</a>
      <a href="../cart.html">Cart</a>
      <a href="../login.html">Login</a>
          <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">ðŸŒ™</button>
    </nav>
  </header>

  <main class="container">
    <h1 id="prod-title">Product</h1>
    <p class="muted" id="prod-desc">Loading product information...</p>
    
    <div class="card mt">
      <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 24px;">
        <div>
          <img src="../assets/img/prod1.jpg" alt="Product" style="width: 100%; border-radius: 8px;" onerror="this.style.display='none'">
        </div>
        <div>
          <div class="price" id="prod-price" style="font-size: 24px; margin-bottom: 16px;">$0.00</div>
          <form name="add-to-cart" data-log>
            <input type="hidden" id="prod-id" name="id" value="">
            <label>Quantity <input type="number" name="qty" value="1" min="1" style="width: 80px;"></label>
            <button type="submit" class="btn mt">Add to Cart</button>
          </form>
          
          <!-- VULNERABLE: IDOR - Price manipulation -->
          <div class="card mt" style="background: #f5f5f5; padding: 16px;">
            <h3>Admin Price Override</h3>
            <form id="price-form">
              <input type="number" name="price" placeholder="New Price" step="0.01">
              <button type="submit">Update Price</button>
            </form>
            <script>
              document.getElementById('price-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const newPrice = e.target.price.value;
                // VULNERABLE: No authorization check
                document.getElementById('prod-price').textContent = '$' + parseFloat(newPrice).toFixed(2);
                alert('Price updated! (Vulnerable to unauthorized price manipulation)');
              });
            </script>
          </div>
        </div>
      </div>
    </div>

    <!-- VULNERABLE: Stored XSS in reviews -->
    <div class="card mt">
      <h2>Customer Reviews</h2>
      <form id="review-form">
        <textarea name="review" placeholder="Write a review..." rows="3" style="width: 100%;"></textarea>
        <button type="submit" class="btn mt">Submit Review</button>
      </form>
      <div id="reviews" class="mt"></div>
      <script>
        function loadReviews() {
          const reviews = JSON.parse(localStorage.getItem('product_reviews') || '[]');
          const container = document.getElementById('reviews');
          container.innerHTML = '';
          reviews.forEach(review => {
            // VULNERABLE: Stored XSS - no sanitization
            container.innerHTML += '<div class="card mt"><p>' + review + '</p></div>';
          });
        }
        loadReviews();
        document.getElementById('review-form').addEventListener('submit', (e) => {
          e.preventDefault();
          const review = e.target.review.value;
          const reviews = JSON.parse(localStorage.getItem('product_reviews') || '[]');
          reviews.push(review);
          localStorage.setItem('product_reviews', JSON.stringify(reviews));
          loadReviews();
          e.target.reset();
        });
      </script>
    </div>
  </main>

  <footer class="footer">
    <a href="../contact.html">Contact</a> Â·
    <a href="../login.html">Login</a> Â·
    <a href="../admin-login.html">Admin</a>
    <div class="muted mt">Â© 2025 VulnShop Inc.</div>
  </footer>

  <script src="../assets/js/logger.js"></script>
  <script src="../assets/js/app.js"></script>
</body>
</html>
